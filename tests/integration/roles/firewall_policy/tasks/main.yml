---
- name: firewall_policy create
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    state: present
    source:
      - "{{ network_list.networks[0].cidr }}"
    destination:
      - "{{ network_list.networks[0].cidr }}"
    ports:
      - any
    destination_account_alias: "{{ account_alias }}"
    wait: True
  register: firewall_policy_create
- name: assert firewall_policy create
  assert:
    that:
      - firewall_policy_create.changed == True

- name: firewall_policy present
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    firewall_policy_id: "{{ firewall_policy_create.firewall_policy.id }}"
    state: present
    wait: True
  register: firewall_policy_present
- name: assert firewall_policy present
  assert:
    that:
      - firewall_policy_present.changed == False

- name: firewall_policy idempotent
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    state: present
    enabled: True
    source:
      - "{{ network_list.networks[0].cidr }}"
    destination:
      - "{{ network_list.networks[0].cidr }}"
    ports:
      - any
    destination_account_alias: "{{ account_alias }}"
    wait: True
  register: firewall_policy_idempotent
- name: assert firewall_policy idempotent
  assert:
    that:
      - firewall_policy_idempotent.changed == False

- name: firewall_policy update ports
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    firewall_policy_id: "{{ firewall_policy_create.firewall_policy.id }}"
    ports:
      - 'tcp/22'
    state: present
    wait: True
  register: firewall_policy_update_ports
- name: assert firewall_policy update ports
  assert:
    that:
      - firewall_policy_update_ports.changed == True

- name: firewall_policy disable
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    firewall_policy_id: "{{ firewall_policy_create.firewall_policy.id }}"
    enabled: False
    state: present
    wait: True
  register: firewall_policy_disable
- name: assert firewall_policy disable
  assert:
    that:
      - firewall_policy_disable.changed == True

- name: firewall_policy reset
  clc_firewall_policy:
    source_account_alias: "{{ account_alias }}"
    location: "{{ location }}"
    firewall_policy_id: "{{ firewall_policy_create.firewall_policy.id }}"
    ports:
      - 'any'
    enabled: True
    state: present
    wait: True
  register: firewall_policy_reset
- name: assert firewall_policy reset
  assert:
    that:
      - firewall_policy_reset.changed == True
