---
- name: alert_policy create
  clc_alert_policy:
    name: "{{ alert_policy_name }}"
    alert_recipients:
      - test1@centurylink.com
    metric: 'cpu'
    duration: '00:10:00'
    threshold: 95
    state: present
  register: alert_policy_create
- name: assert alert_policy create
  assert:
    that:
      - alert_policy_create.changed == True

- pause: seconds=3

- name: alert_policy present
  clc_alert_policy:
    name: "{{ alert_policy_name }}"
    state: present
  register: alert_policy_present
- name: assert alert_policy present
  assert:
    that:
      - alert_policy_present.changed == False

- name: alert_policy update trigger
  clc_alert_policy:
    name: "{{ alert_policy_name }}"
    metric: 'cpu'
    duration: '00:15:00'
    threshold: 95
    state: present
  register: alert_policy_update_trigger
- name: assert alert_policy update trigger
  assert:
    that:
      - alert_policy_update_trigger.changed == True

- name: alert_policy update emails
  clc_alert_policy:
    name: "{{ alert_policy_name }}"
    alert_recipients:
      - test2@centurylink.com
      - test3@centurylink.com
    state: present
  register: alert_policy_update_email
- name: assert alert_policy update emails
  assert:
    that:
      - alert_policy_update_email.changed == True
